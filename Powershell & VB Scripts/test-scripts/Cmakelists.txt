cmake_minimum_required(VERSION 3.20)
project(BuildEnvTest VERSION 1.0 LANGUAGES CXX)

# Set C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Print build configuration information
message(STATUS "=================================")
message(STATUS "Build Configuration:")
message(STATUS "=================================")
message(STATUS "CMake Version: ${CMAKE_VERSION}")
message(STATUS "Generator: ${CMAKE_GENERATOR}")
message(STATUS "C++ Compiler: ${CMAKE_CXX_COMPILER}")
message(STATUS "C++ Compiler ID: ${CMAKE_CXX_COMPILER_ID}")
message(STATUS "C++ Compiler Version: ${CMAKE_CXX_COMPILER_VERSION}")
message(STATUS "Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "System: ${CMAKE_SYSTEM_NAME}")
message(STATUS "System Processor: ${CMAKE_SYSTEM_PROCESSOR}")

# Detect if we're using MSVC or MinGW
if(MSVC)
    message(STATUS "Toolchain: MSVC")
    if(CMAKE_CXX_COMPILER_ID MATCHES "Clang")
        message(STATUS "Frontend: Clang-cl (MSVC-compatible)")
    endif()
elseif(MINGW)
    message(STATUS "Toolchain: MinGW/MSYS2")
endif()

message(STATUS "=================================")

# Create executable
add_executable(test_build test_build.cpp)

# Platform-specific settings
if(MSVC)
    # MSVC or Clang-cl specific flags
    target_compile_options(test_build PRIVATE
        /W4          # Warning level 4
        /permissive- # Standards conformance
    )
elseif(CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
    # GCC or Clang specific flags
    target_compile_options(test_build PRIVATE
        -Wall
        -Wextra
        -pedantic
    )
endif()

# Print post-build message
add_custom_command(TARGET test_build POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E echo ""
    COMMAND ${CMAKE_COMMAND} -E echo "==================================="
    COMMAND ${CMAKE_COMMAND} -E echo "Build completed successfully!"
    COMMAND ${CMAKE_COMMAND} -E echo "Executable: $<TARGET_FILE:test_build>"
    COMMAND ${CMAKE_COMMAND} -E echo "==================================="
)
